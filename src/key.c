#include "../includes/malware.h"

unsigned char *generate_key() {
    unsigned char *key = malloc(KEY_SIZE);
    if (!key)
        return (error_msg("key malloc()"), NULL);

    FILE *urandom = fopen("/dev/urandom", "rb");
    if (!urandom)
        return (error_msg("cannot open /dev/urandom"), NULL);

    fread(key, 1, KEY_SIZE, urandom);
    fclose(urandom);

    return key;
}

unsigned char* parse_key(const char *key_str) {
    unsigned char *key = malloc(KEY_SIZE);
    if (key == NULL) {
        perror("Erreur lors de l'allocation de mémoire pour la clé");
        exit(EXIT_FAILURE);
    }

    for (int i = 0; i < KEY_SIZE * 2; i += 2) {
        sscanf(key_str + i, "%2hhx", &key[i / 2]);
    }

    return key;
}

void print_key(unsigned char *key) {
    for (int i = 0; i < KEY_SIZE; i++)
        printf("%02x", key[i]);
    printf(RESET "\n");
}